# Firebase Email Verification Setup Guide

## Overview
This app uses Firebase Authentication with email verification. After users register with email/password, they'll receive a verification email and must verify their email before they can sign in.

## Setup Steps

### 1. Configure Firebase Project

1. Go to [Firebase Console](https://console.firebase.google.com/)
2. Create a new project or select an existing one
3. Enable Authentication:
   - Go to **Authentication** > **Sign-in method**
   - Enable **Email/Password** authentication
   - Configure email templates (optional but recommended):
     - Go to **Authentication** > **Templates**
     - Customize the email verification template

### 2. Configure Flutter App

Run the following command in your project root:
```bash
flutterfire configure
```

This will:
- Generate `firebase_options.dart` file
- Configure Firebase for your platforms (Android/iOS)

### 3. Update main.dart

Make sure your `lib/main.dart` includes Firebase initialization:

```dart
import 'package:firebase_core/firebase_core.dart';
import 'firebase_options.dart'; // Generated by flutterfire configure

void main() async {
  WidgetsFlutterBinding.ensureInitialized();
  
  await Firebase.initializeApp(
    options: DefaultFirebaseOptions.currentPlatform,
  );
  
  runApp(const MyApp());
}
```

### 4. Android Configuration

Make sure your `android/app/src/main/AndroidManifest.xml` includes internet permission:
```xml
<uses-permission android:name="android.permission.INTERNET"/>
```

### 5. iOS Configuration (if developing for iOS)

1. In Firebase Console, add an iOS app to your project
2. Download `GoogleService-Info.plist`
3. Add it to `ios/Runner/` in Xcode
4. Update `ios/Runner/Info.plist` with your REVERSED_CLIENT_ID

### 6. Email Verification Flow

The app follows this flow:

1. **Registration (OnboardingScreen)**:
   - User enters name, email, password
   - Account is created with Firebase Auth
   - Email verification is automatically sent
   - User is navigated to EmailVerificationScreen

2. **Email Verification (EmailVerificationScreen)**:
   - User sees instructions to check their email
   - User clicks verification link in email
   - User clicks "I've Verified My Email" button
   - App checks verification status
   - If verified, user is navigated to HomeScreen

3. **Login (LoginScreen)**:
   - User enters email and password
   - App checks if email is verified
   - If not verified, login is rejected with error message
   - If verified, user is signed in and navigated to HomeScreen

### 7. Customizing Email Templates (Optional)

1. Go to Firebase Console > Authentication > Templates
2. Click on "Email address verification"
3. Customize the email template:
   - Subject line
   - Email body
   - Action button text
   - Footer text

### 8. Testing Email Verification

**Important Notes:**
- In development, you can test with any email address
- The verification email will be sent to the email address provided
- Click the verification link in the email to verify the account
- After clicking the link, return to the app and click "I've Verified My Email"

**For Testing:**
- Use a real email address you have access to
- Check spam folder if email doesn't arrive
- Verification link expires after some time (default: 3 days)

### 9. Troubleshooting

**Email not received:**
- Check spam/junk folder
- Verify email address is correct
- Check Firebase Console > Authentication > Users to see if user was created
- Try resending verification email from the app

**Verification not working:**
- Make sure you clicked the link in the email
- Check if link has expired
- Try resending verification email
- Check Firebase Console for any errors

**Login fails after verification:**
- Make sure you clicked "I've Verified My Email" button after verifying
- Check Firebase Console > Authentication > Users to see verification status
- Try signing out and signing in again

### 10. Production Considerations

1. **Email Delivery:**
   - Firebase uses SendGrid for email delivery
   - Free tier has limits (check Firebase pricing)
   - For high volume, consider upgrading plan

2. **Security:**
   - Email verification helps prevent fake accounts
   - Consider adding rate limiting for signup attempts
   - Monitor for suspicious activity in Firebase Console

3. **User Experience:**
   - Provide clear instructions in EmailVerificationScreen
   - Allow users to resend verification email
   - Consider showing a countdown timer for resend cooldown

## Code Structure

### AuthService Methods:
- `signUp()`: Creates user and sends verification email
- `signIn()`: Signs in user (checks email verification)
- `sendEmailVerification()`: Resends verification email
- `checkEmailVerification()`: Checks if email is verified

### Screens:
- `OnboardingScreen`: Registration form
- `EmailVerificationScreen`: Email verification instructions and status check
- `LoginScreen`: Login form with email verification check

## Next Steps

After setting up Firebase:
1. Run `flutterfire configure` to generate configuration files
2. Test registration flow
3. Test email verification
4. Test login with verified email
5. Customize email templates if needed

